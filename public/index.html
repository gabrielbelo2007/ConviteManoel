<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <title>Manoel Goncalves - Meu Aniversário!</title>
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&family=Anton&family=Roboto+Mono:wght@400;700&family=Bebas+Neue&family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header class="hero-section">
      <img src="https://i.imgur.com/afdxqoy.jpeg" style="max-width: 100%; height: auto;">
    </header>

    <main class="container">

        <section class="tray blue">
            <div class="tray-content">
                <h2>DETALHES DA FESTA</h2>
                <img src="https://i.imgur.com/H2Bm6E7.png" style="max-width: 50%;"> <p><strong>Data:</strong> 19/07/2025</p>
                <p><strong>Hora:</strong> A partir das 12h</p>
                <p><strong>Local:</strong> Aver o Mar – Sirinhaém</p>
                <p><strong>Recomendações:</strong> Levar crianças e roupa de banho!</p>
                <div class="label price">DIVERSÃO GARANTIDA</div>
            </div>
        </section>

        <section class="tray green">
            <div class="tray-content">
                <h2>MANOEL GONÇALVES</h2>
                <p>42 anos de qualidade</p>
                <p><strong>Data de Fabricação</strong>: 15/07/1983</p>
                <p><strong>Preço: Inestimável</strong></p>
                <p><strong>Ingredientes</strong>: Cabuloso, Curioso, Visionário, Teimoso, Arretado, Pertubador, Chato, etc.</p>
                <p><strong>Data de Validade</strong>: <span>15/07/2023</span></p>
                <div class="label">EDIÇÃO ESPECIAL</div>
                <div class="stamp">PRODUTO<br>FORA DA VALIDADE</div>
            </div>
        </section>

        <section class="form-section">
            <div class="form-content">
                <h2>CONFIRME SUA PRESENÇA</h2>
                <form id="form-confirmacao">
                    <label>Nome:
                        <input name="nome" type="text" required>
                    </label>
                    <label>Telefone:
                        <input name="telefone" type="tel" required>
                    </label>
                    <label>E-mail:
                        <input name="email" type="email" required> </label>
                    <button type="submit">Confirmar Presença</button>
                </form>
                <p id="msg"></p>

                <div class="button-group">
                    <button id="add-to-calendar" class="add-to-calendar-button">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Google_Calendar_icon_%282020%29.svg" alt="Ícone Google Agenda">
                        <span>Adicionar à Agenda</span>
                    </button>
                </div>
            </div>
        </section>

    </main>

    <footer class="final-message">
        <img src="https://i.imgur.com/gDZikuL.png" style="max-width: 85%;">
    </footer>

    <section class="footer-map">
        <h2>ONDE NOS ENCONTRAR?</h2>
        <iframe
            width="100%"
            height="300"
            style="border:0; border-radius: 10px;"
            loading="lazy"
            allowfullscreen
            referrerpolicy="no-referrer-when-downgrade"
            src="https://www.google.com/maps/embed/v1/place?key=AIzaSyC3z9JStWHDQ265u0Ow9tePFXj3xEa7nI8&q=-8.668925285339355,-35.07130813598633&zoom=17">
        </iframe>
    </section>

<script>
  // Função para gerar o link do Google Agenda (MANTENHA ESTA FUNÇÃO INTACTA)
  function generateGoogleCalendarLink(eventName, eventDate, eventTime) {
      const baseUrl = "https://calendar.google.com/calendar/render?action=TEMPLATE";
      const details = encodeURIComponent("Venha celebrar meu aniversário! Haverá muita comida, bebida e diversão. Não perca!");
      const location = encodeURIComponent("Aver o Mar – Sirinhaém");

      // Definir data e hora para o fuso horário de Recife, PE, Brasil (-03:00)
      const startDateTime = new Date('2025-07-19T12:00:00');
      const endDateTime = new Date('2025-07-19T18:00:00');

      const formatToGoogleCalendarTime = (date) => {
          const year = date.getFullYear();
          const month = (date.getMonth() + 1).toString().padStart(2, '0');
          const day = date.getDate().toString().padStart(2, '0');
          const hours = date.getHours().toString().padStart(2, '0');
          const minutes = date.getMinutes().toString().padStart(2, '0');
          const seconds = date.getSeconds().toString().padStart(2, '0');
          return `<span class="math-inline">\{year\}</span>{month}<span class="math-inline">\{day\}T</span>{hours}<span class="math-inline">\{minutes\}</span>{seconds}`;
      };

      const dates = `<span class="math-inline">\{formatToGoogleCalendarTime\(startDateTime\)\}/</span>{formatToGoogleCalendarTime(endDateTime)}`;

      const link = `<span class="math-inline">\{baseUrl\}&text\=</span>{encodeURIComponent(eventName)}&dates=<span class="math-inline">\{dates\}&details\=</span>{details}&location=${location}&sf=true&output=xml`;
      return link;
  }

    // Event listener para o formulário de confirmação (ESTE É O BLOCO QUE DEVE SER CORRIGIDO)
    document.getElementById('form-confirmacao').addEventListener('submit', async function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const data = {};
        formData.forEach((v, k) => data[k] = v);

        const msgElement = document.getElementById('msg');
        msgElement.innerText = "Enviando confirmação..."; // Mensagem de carregamento

        try {
        // Faz a requisição para a sua Serverless Function na Vercel
        const response = await fetch('/api/submit-form', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });

        const result = await response.json(); // Pega a resposta JSON da sua API

        if (response.ok && result.success) { // Verifica se a requisição foi bem-sucedida (status 2xx) E se a API retornou sucesso
            msgElement.innerText = "Presença confirmada na planilha, espero você lá!";
            this.reset(); // Limpa o formulário apenas em caso de sucesso
        } else {
            // Se a requisição falhou (status diferente de 2xx) ou a API retornou sucesso: false
            msgElement.innerText = `Ocorreu um problema ao confirmar presença: ${result.message || 'Erro desconhecido.'}`;
            console.error('Erro ao confirmar presença:', result.message || 'Erro desconhecido.');
        }
        } catch (error) {
        msgElement.innerText = `Erro na requisição: ${error.message}`;
        console.error('Erro ao enviar formulário:', error);
        }
    });

    // Event listener para o botão "Adicionar à Agenda" (MANTENHA ESTA FUNÇÃO INTACTA)
    document.getElementById('add-to-calendar').addEventListener('click', function() {
        const eventName = "Aniversário do Manoel Gonçalves";
        const calendarLink = generateGoogleCalendarLink(eventName);
        window.open(calendarLink, '_blank');
    });
</script>
</body>
</html>